language: php

php:
 - 5.6

before_script:
 - mkdir -p shippable/codecoverage
 - mkdir -p shippable/testresults
 - composer self-update
 - composer global require "fxp/composer-asset-plugin:1.0.0" -n --prefer-source
 #- composer global require "codeception/codeception=2.0.*"
 #- composer global require "codeception/codeception:*" -n --prefer-source
 #- composer global require "codeception/specify=*" "codeception/verify=*" -n --prefer-source
 - composer install -n --prefer-source --dev
 - export CURRENTBINDIR=`pwd`
 - export PATH="$CURRENTBINDIR/vendor/bin:$PATH"
 #- cd tests
 #- codecept build
 - ls
 - mysql -e 'CREATE DATABASE notabenoid_tests;';
 - cd tests/codeception/bin && php yii migrate all --interactive=0 && cd ../../..

script:
 - php -S localhost:8080 > /dev/null 2>&1 &
 - cd tests
 - codecept run --xml --coverage --coverage-xml --coverage-html
 - cd codeception/_output
 - cp coverage.xml ../../../../shippable/codecoverage
 - cp report.xml ../../../../shippable/testresults
 - ls

notifications:
  email: false
